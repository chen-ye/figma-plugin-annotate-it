<template>
  <div class="grid">
    <Sidebar />

    <div class="content">
      <AnnotationList v-if="annotData && annotData.length" />

      <div class="emptyState" v-else>
        <div class="emptyState-inner">
          <div class="emptyState-step1" :class="{ 'fadeOut': userSelection.length === 1 }">
            <svg class="emptyState-step1-illustration" xmlns="http://www.w3.org/2000/svg" width="252" height="167" fill="none" viewBox="0 0 252 167">
              <rect width="252" height="167" fill="#F0F0F0" rx="8"/><path fill="#fff" stroke="#18A0FB" stroke-width="2" d="M57 39h138v89H57z"/><path fill="#fff" stroke="#18A0FB" stroke-width="1.5" d="M191 124h8v8h-8zM191 35h8v8h-8zM53 35h8v8h-8zM53 124h8v8h-8z"/><path fill="#464646" d="M0 0h252v10H0z"/><path fill="#fff" d="M0 10h40v157H0zM212 10h40v157h-40z"/><rect width="15" height="1" x="216" y="16" fill="#E2E2E2" rx=".5"/><rect width="15" height="1" x="216" y="35" fill="#E2E2E2" rx=".5"/><rect width="19" height="1" x="216" y="20" fill="#E2E2E2" rx=".5"/><rect width="19" height="1" x="216" y="39" fill="#E2E2E2" rx=".5"/><path fill="#F7F7F7" d="M212 28h40v1h-40z"/><rect width="15" height="1" x="216" y="53" fill="#E2E2E2" rx=".5"/><rect width="19" height="1" x="216" y="57" fill="#E2E2E2" rx=".5"/><path fill="#F7F7F7" d="M212 46h40v1h-40z"/><rect width="7" height="2" x="4" y="14" fill="#E2E2E2" rx="1"/><rect width="7" height="2" x="15" y="14" fill="#E2E2E2" rx="1"/><rect width="15" height="1" x="4" y="25" fill="#E2E2E2" rx=".5"/><rect width="15" height="1" x="4" y="45" fill="#E2E2E2" rx=".5"/><rect width="14" height="1" x="4" y="29" fill="#E2E2E2" rx=".5"/><rect width="19" height="1" x="4" y="49" fill="#E2E2E2" rx=".5"/><rect width="14" height="1" x="8" y="33" fill="#E2E2E2" rx=".5"/><rect width="11" height="1" x="8" y="53" fill="#E2E2E2" rx=".5"/><rect width="13" height="1" x="8" y="37" fill="#E2E2E2" rx=".5"/><rect width="13" height="1" x="8" y="57" fill="#E2E2E2" rx=".5"/>
            </svg>

            <svg class="emptyState-step1-text" xmlns="http://www.w3.org/2000/svg" width="162" height="44" fill="none" viewBox="0 0 162 44">
              <path stroke="#E5E5E5" stroke-linecap="round" stroke-width="2" d="M135.5 2.5S134 9 127 15c-8.166 7-18.5 7-18.5 7"/><path stroke="#E5E5E5" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M140.081 11.955c-.174-.332-2.666-6.396-4.126-9.955L126 6.126"/><path fill="#000" fill-opacity=".3" d="M.969 24h.969v-3.578h3.468v-.86H1.938V16.86h3.828V16H.969v8zM7.3 24h.922v-6H7.3v6zm.469-7c.359 0 .656-.281.656-.625s-.297-.625-.656-.625c-.36 0-.657.281-.657.625S7.41 17 7.77 17zM9.91 24h.922v-3.797c0-.812.64-1.406 1.516-1.406.246 0 .5.047.562.062v-.937a8.872 8.872 0 00-.484-.016c-.719 0-1.344.407-1.563 1h-.062V18h-.89v6zM18.253 19.344c-.29-.852-.938-1.422-2.125-1.422-1.266 0-2.203.719-2.203 1.734 0 .828.492 1.383 1.594 1.64l1 .235c.605.14.89.43.89.844 0 .516-.547.938-1.406.938-.754 0-1.227-.325-1.39-.97l-.876.22c.215 1.019 1.055 1.562 2.282 1.562 1.394 0 2.343-.762 2.343-1.797 0-.836-.523-1.363-1.593-1.625l-.891-.219c-.711-.175-1.031-.414-1.031-.875 0-.515.547-.89 1.28-.89.806 0 1.138.445 1.298.86l.828-.235zM22.36 18h-1.282v-1.438h-.922V18h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .563-.062.688-.11l-.188-.827c-.078.015-.203.047-.406.047-.406 0-.797-.125-.797-.907v-3.5h1.281V18zM31.09 19.344c-.29-.852-.938-1.422-2.125-1.422-1.266 0-2.203.719-2.203 1.734 0 .828.492 1.383 1.593 1.64l1 .235c.606.14.891.43.891.844 0 .516-.547.938-1.406.938-.754 0-1.227-.325-1.39-.97l-.876.22c.215 1.019 1.055 1.562 2.281 1.562 1.395 0 2.344-.762 2.344-1.797 0-.836-.523-1.363-1.594-1.625l-.89-.219c-.711-.175-1.031-.414-1.031-.875 0-.515.546-.89 1.28-.89.806 0 1.138.445 1.298.86l.828-.235zM35.102 24.125c1.22 0 2.11-.61 2.391-1.516l-.89-.25c-.235.625-.778.938-1.5.938-1.083 0-1.829-.7-1.872-1.985h4.356v-.39c0-2.235-1.328-3-2.578-3-1.625 0-2.703 1.281-2.703 3.125s1.062 3.078 2.797 3.078zm-1.87-3.61c.062-.933.722-1.765 1.777-1.765 1 0 1.64.75 1.64 1.766h-3.418zM39.911 16h-.922v8h.922v-8zM44.115 24.125c1.219 0 2.11-.61 2.39-1.516l-.89-.25c-.234.625-.777.938-1.5.938-1.082 0-1.828-.7-1.87-1.985H46.6v-.39c0-2.235-1.328-3-2.578-3-1.625 0-2.704 1.281-2.704 3.125s1.063 3.078 2.797 3.078zm-1.87-3.61c.062-.933.722-1.765 1.777-1.765 1 0 1.64.75 1.64 1.766h-3.418zM50.44 24.125c1.328 0 2.203-.813 2.359-1.875h-.922c-.172.656-.719 1.047-1.438 1.047-1.093 0-1.796-.906-1.796-2.297 0-1.36.718-2.25 1.797-2.25.812 0 1.296.5 1.437 1.047h.922c-.156-1.125-1.11-1.875-2.375-1.875-1.625 0-2.703 1.281-2.703 3.11 0 1.796 1.031 3.093 2.719 3.093zM56.756 18h-1.281v-1.438h-.922V18h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .562-.062.687-.11l-.187-.827c-.078.015-.203.047-.406.047-.407 0-.797-.125-.797-.907v-3.5h1.28V18zM63.002 24.14c1.047 0 1.594-.562 1.781-.953h.047V24h.922v-3.953c0-1.906-1.453-2.125-2.219-2.125-.906 0-1.937.312-2.406 1.406l.875.313c.203-.438.683-.907 1.563-.907.847 0 1.265.45 1.265 1.22v.03c0 .446-.453.407-1.547.547-1.113.145-2.328.39-2.328 1.766 0 1.172.906 1.844 2.047 1.844zm.14-.828c-.734 0-1.265-.328-1.265-.968 0-.703.64-.922 1.36-1.016.39-.047 1.437-.156 1.593-.344v.844c0 .75-.594 1.485-1.687 1.485zM73.2 18h-1.344v-.61c0-.593.25-.906.86-.906.265 0 .422.063.515.094l.266-.797c-.14-.062-.422-.156-.875-.156-.86 0-1.687.516-1.687 1.547V18h-.97v.781h.97V24h.921v-5.219H73.2V18zM74.492 24h.922v-3.797c0-.812.64-1.406 1.516-1.406.246 0 .5.047.562.062v-.937a8.872 8.872 0 00-.484-.016c-.719 0-1.344.407-1.563 1h-.062V18h-.89v6zM80.35 24.14c1.047 0 1.594-.562 1.782-.953h.047V24h.922v-3.953c0-1.906-1.454-2.125-2.22-2.125-.905 0-1.937.312-2.405 1.406l.875.313c.203-.438.683-.907 1.562-.907.848 0 1.266.45 1.266 1.22v.03c0 .446-.453.407-1.547.547-1.113.145-2.328.39-2.328 1.766 0 1.172.906 1.844 2.047 1.844zm.141-.828c-.734 0-1.265-.328-1.265-.968 0-.703.64-.922 1.359-1.016.39-.047 1.438-.156 1.594-.344v.844c0 .75-.594 1.485-1.688 1.485zM84.783 24h.922v-3.75c0-.879.64-1.5 1.36-1.5.699 0 1.187.457 1.187 1.14V24h.938v-3.906c0-.774.484-1.344 1.328-1.344.656 0 1.218.348 1.218 1.234V24h.922v-4.016c0-1.41-.758-2.062-1.828-2.062-.86 0-1.488.394-1.797 1.015h-.062c-.297-.64-.82-1.015-1.61-1.015-.78 0-1.359.375-1.609 1.015h-.078V18h-.89v6zM96.86 24.125c1.218 0 2.109-.61 2.39-1.516l-.89-.25c-.235.625-.778.938-1.5.938-1.083 0-1.829-.7-1.872-1.985h4.356v-.39c0-2.235-1.328-3-2.578-3-1.625 0-2.704 1.281-2.704 3.125s1.063 3.078 2.797 3.078zm-1.872-3.61c.063-.933.723-1.765 1.778-1.765 1 0 1.64.75 1.64 1.766h-3.418zM1.438 42.25c.832 0 1.417-.441 1.765-1.375l2.555-6.86L4.75 34l-1.656 4.781H3.03L1.375 34h-1l2.219 6.031-.172.469c-.336.914-.75 1-1.422.828l-.234.813c.093.047.359.109.671.109zM9.2 40.125c1.625 0 2.719-1.234 2.719-3.094 0-1.875-1.094-3.11-2.719-3.11-1.625 0-2.719 1.235-2.719 3.11 0 1.86 1.094 3.094 2.72 3.094zm0-.828c-1.234 0-1.797-1.063-1.797-2.266S7.966 34.75 9.2 34.75c1.235 0 1.797 1.078 1.797 2.281s-.562 2.266-1.797 2.266zM17.107 37.547c0 1.125-.859 1.64-1.546 1.64-.766 0-1.313-.562-1.313-1.437V34h-.922v3.813c0 1.53.813 2.265 1.938 2.265.906 0 1.5-.484 1.78-1.094h.063V40h.922v-6h-.922v3.547zM24.17 40h.907l1.313-4.61h.093L27.796 40h.906l1.828-6h-.969l-1.296 4.578h-.063L26.936 34h-.984l-1.281 4.594h-.063L23.311 34h-.968l1.828 6zM33.515 40.14c1.047 0 1.593-.562 1.78-.953h.048V40h.922v-3.953c0-1.906-1.453-2.125-2.22-2.125-.905 0-1.937.312-2.405 1.406l.875.313c.203-.438.683-.907 1.562-.907.848 0 1.266.45 1.266 1.22v.03c0 .446-.453.407-1.547.547-1.113.145-2.328.39-2.328 1.766 0 1.172.906 1.844 2.047 1.844zm.14-.828c-.734 0-1.265-.328-1.265-.968 0-.703.64-.922 1.359-1.016.39-.047 1.438-.156 1.594-.344v.844c0 .75-.594 1.484-1.688 1.484zM38.87 36.39c0-1.046.648-1.64 1.53-1.64.856 0 1.375.559 1.375 1.5V40h.922v-3.813c0-1.53-.816-2.265-2.031-2.265-.906 0-1.469.406-1.75 1.016h-.078V34h-.89v6h.921v-3.61zM46.991 34H45.71v-1.438h-.922V34h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .563-.062.688-.11l-.188-.827c-.078.015-.203.047-.406.047-.406 0-.797-.126-.797-.907v-3.5h1.281V34zM54.081 34H52.8v-1.438h-.922V34h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .562-.062.687-.11l-.187-.827c-.078.015-.203.047-.406.047-.407 0-.797-.126-.797-.907v-3.5h1.281V34zM57.84 40.125c1.626 0 2.72-1.234 2.72-3.094 0-1.875-1.094-3.11-2.72-3.11-1.624 0-2.718 1.235-2.718 3.11 0 1.86 1.094 3.094 2.719 3.094zm0-.828c-1.234 0-1.796-1.063-1.796-2.266s.562-2.281 1.797-2.281c1.234 0 1.797 1.078 1.797 2.281s-.563 2.266-1.797 2.266zM66.826 40.14c1.047 0 1.594-.562 1.781-.953h.047V40h.922v-3.953c0-1.906-1.453-2.125-2.219-2.125-.906 0-1.937.312-2.406 1.406l.875.313c.203-.438.684-.907 1.563-.907.847 0 1.265.45 1.265 1.22v.03c0 .446-.453.407-1.547.547-1.113.145-2.328.39-2.328 1.766 0 1.172.907 1.844 2.047 1.844zm.14-.828c-.734 0-1.265-.328-1.265-.968 0-.703.64-.922 1.36-1.016.39-.047 1.437-.156 1.593-.344v.844c0 .75-.593 1.484-1.687 1.484zM73.524 40.125c1.157 0 1.547-.719 1.75-1.047h.11V40h.89v-8h-.921v2.953h-.079c-.203-.312-.562-1.031-1.734-1.031-1.516 0-2.563 1.203-2.563 3.094 0 1.906 1.047 3.109 2.547 3.109zm.125-.828c-1.156 0-1.75-1.016-1.75-2.297 0-1.266.579-2.25 1.75-2.25 1.125 0 1.72.906 1.72 2.25 0 1.36-.61 2.297-1.72 2.297zM80.356 40.125c1.157 0 1.547-.719 1.75-1.047h.11V40h.89v-8h-.921v2.953h-.079c-.203-.312-.562-1.031-1.734-1.031-1.516 0-2.562 1.203-2.562 3.094 0 1.906 1.046 3.109 2.546 3.109zm.125-.828c-1.156 0-1.75-1.016-1.75-2.297 0-1.266.579-2.25 1.75-2.25 1.125 0 1.72.906 1.72 2.25 0 1.36-.61 2.297-1.72 2.297zM89.782 40.14c1.047 0 1.594-.562 1.782-.953h.046V40h.922v-3.953c0-1.906-1.453-2.125-2.218-2.125-.907 0-1.938.312-2.407 1.406l.875.313c.203-.438.684-.907 1.563-.907.847 0 1.265.45 1.265 1.22v.03c0 .446-.453.407-1.546.547-1.114.145-2.329.39-2.329 1.766 0 1.172.907 1.844 2.047 1.844zm.14-.828c-.733 0-1.265-.328-1.265-.968 0-.703.64-.922 1.36-1.016.39-.047 1.437-.156 1.593-.344v.844c0 .75-.593 1.484-1.687 1.484zM95.137 36.39c0-1.046.648-1.64 1.531-1.64.855 0 1.375.559 1.375 1.5V40h.922v-3.813c0-1.53-.817-2.265-2.031-2.265-.907 0-1.47.406-1.75 1.016h-.078V34h-.891v6h.922v-3.61zM101.571 36.39c0-1.046.649-1.64 1.532-1.64.855 0 1.375.559 1.375 1.5V40h.921v-3.813c0-1.53-.816-2.265-2.031-2.265-.906 0-1.469.406-1.75 1.016h-.078V34h-.891v6h.922v-3.61zM109.521 40.125c1.625 0 2.719-1.234 2.719-3.094 0-1.875-1.094-3.11-2.719-3.11-1.625 0-2.718 1.235-2.718 3.11 0 1.86 1.093 3.094 2.718 3.094zm0-.828c-1.234 0-1.796-1.063-1.796-2.266s.562-2.281 1.796-2.281c1.235 0 1.797 1.078 1.797 2.281s-.562 2.266-1.797 2.266zM116.257 34h-1.281v-1.438h-.922V34h-.907v.781h.907v3.75c0 1.047.843 1.547 1.625 1.547.343 0 .562-.062.687-.11l-.187-.827c-.078.015-.203.047-.407.047-.406 0-.796-.126-.796-.907v-3.5h1.281V34zM119.409 40.14c1.047 0 1.594-.562 1.781-.953h.047V40h.922v-3.953c0-1.906-1.453-2.125-2.219-2.125-.906 0-1.937.312-2.406 1.406l.875.313c.203-.438.684-.907 1.563-.907.847 0 1.265.45 1.265 1.22v.03c0 .446-.453.407-1.547.547-1.113.145-2.328.39-2.328 1.766 0 1.172.907 1.844 2.047 1.844zm.141-.828c-.735 0-1.266-.328-1.266-.968 0-.703.641-.922 1.36-1.016.39-.047 1.437-.156 1.593-.344v.844c0 .75-.593 1.484-1.687 1.484zM126.451 34h-1.281v-1.438h-.922V34h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .563-.062.688-.11l-.188-.827c-.078.015-.203.047-.406.047-.406 0-.797-.126-.797-.907v-3.5h1.281V34zM127.838 40h.922v-6h-.922v6zm.469-7c.359 0 .656-.281.656-.625s-.297-.625-.656-.625c-.36 0-.657.281-.657.625s.297.625.657.625zM132.886 40.125c1.625 0 2.718-1.234 2.718-3.094 0-1.875-1.093-3.11-2.718-3.11s-2.719 1.235-2.719 3.11c0 1.86 1.094 3.094 2.719 3.094zm0-.828c-1.235 0-1.797-1.063-1.797-2.266s.562-2.281 1.797-2.281c1.234 0 1.797 1.078 1.797 2.281s-.563 2.266-1.797 2.266zM137.934 36.39c0-1.046.648-1.64 1.531-1.64.855 0 1.375.559 1.375 1.5V40h.922v-3.813c0-1.53-.817-2.265-2.032-2.265-.906 0-1.468.406-1.75 1.016h-.078V34h-.89v6h.922v-3.61zM147.696 35.344c-.289-.852-.937-1.422-2.125-1.422-1.265 0-2.203.719-2.203 1.734 0 .828.492 1.383 1.594 1.64l1 .235c.605.14.891.43.891.844 0 .516-.547.938-1.407.938-.754 0-1.226-.325-1.39-.97l-.875.22c.215 1.019 1.054 1.562 2.281 1.562 1.394 0 2.344-.762 2.344-1.797 0-.836-.524-1.363-1.594-1.625l-.891-.219c-.711-.175-1.031-.414-1.031-.875 0-.515.547-.89 1.281-.89.805 0 1.137.445 1.297.86l.828-.235zM154.896 34h-1.281v-1.438h-.922V34h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .563-.062.688-.11l-.188-.827c-.078.015-.203.047-.406.047-.406 0-.797-.126-.797-.907v-3.5h1.281V34zM158.656 40.125c1.625 0 2.719-1.234 2.719-3.094 0-1.875-1.094-3.11-2.719-3.11-1.625 0-2.718 1.235-2.718 3.11 0 1.86 1.093 3.094 2.718 3.094zm0-.828c-1.234 0-1.797-1.063-1.797-2.266s.563-2.281 1.797-2.281c1.235 0 1.797 1.078 1.797 2.281s-.562 2.266-1.797 2.266z"/>
            </svg>
          </div>

          <div class="emptyState-step2" :class="{ 'fadeOut': userSelection.length !== 1 }">
            <Button
              class="emptyState-step2-button"
              buttonType="primary"
              :disabled="userSelection.length !== 1"
              @click="createFirstAnnot">

              <Icon iconName="plus" />Create annotation
            </Button>

            <svg class="emptyState-step2-text" xmlns="http://www.w3.org/2000/svg" width="131" height="44" fill="none" viewBox="0 0 131 44"><path stroke="#E5E5E5" stroke-linecap="round" stroke-width="2" d="M7.081 2.5s1.5 6.5 8.5 12.5c8.166 7 18.5 7 18.5 7"/><path stroke="#E5E5E5" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.5 11.955C2.674 11.623 5.166 5.56 6.626 2l9.955 4.126"/><path fill="#000" fill-opacity=".3" d="M49.313 16h-.954v6.297h-.078L43.906 16h-.937v8h.968v-6.281h.079L48.375 24h.938v-8zm4.25 8.125c1.625 0 2.72-1.234 2.72-3.094 0-1.875-1.095-3.11-2.72-3.11-1.625 0-2.718 1.235-2.718 3.11 0 1.86 1.093 3.094 2.718 3.094zm0-.828c-1.234 0-1.796-1.063-1.796-2.266s.562-2.281 1.796-2.281c1.235 0 1.797 1.078 1.797 2.281s-.562 2.266-1.797 2.266zm5.282.703h.906l1.313-4.61h.093L62.47 24h.906l1.828-6h-.969l-1.297 4.578h-.062L61.61 18h-.984l-1.281 4.594h-.063L57.985 18h-.968l1.828 6zm13.11.125c1.327 0 2.202-.813 2.359-1.875h-.922c-.172.656-.72 1.047-1.438 1.047-1.094 0-1.797-.906-1.797-2.297 0-1.36.719-2.25 1.797-2.25.813 0 1.297.5 1.438 1.047h.922c-.157-1.125-1.11-1.875-2.375-1.875-1.625 0-2.704 1.281-2.704 3.11 0 1.796 1.032 3.093 2.72 3.093zM75.66 24h.922v-3.797c0-.812.64-1.406 1.516-1.406.246 0 .5.047.562.062v-.937a8.865 8.865 0 00-.484-.016c-.719 0-1.344.407-1.563 1h-.062V18h-.89v6zm6.426.125c1.219 0 2.11-.61 2.39-1.516l-.89-.25c-.234.625-.777.938-1.5.938-1.082 0-1.828-.7-1.871-1.985h4.355v-.39c0-2.235-1.328-3-2.578-3-1.625 0-2.703 1.281-2.703 3.125s1.063 3.078 2.797 3.078zm-1.871-3.61c.062-.933.723-1.765 1.777-1.765 1 0 1.64.75 1.64 1.766h-3.417zm7.523 3.626c1.047 0 1.594-.563 1.781-.953h.047V24h.922v-3.953c0-1.906-1.453-2.125-2.219-2.125-.906 0-1.937.312-2.406 1.406l.875.313c.203-.438.684-.907 1.563-.907.847 0 1.265.45 1.265 1.22v.03c0 .446-.453.407-1.546.547-1.114.145-2.329.39-2.329 1.766 0 1.172.907 1.844 2.047 1.844zm.14-.828c-.734 0-1.265-.329-1.265-.97 0-.702.64-.921 1.36-1.015.39-.047 1.437-.156 1.593-.344v.844c0 .75-.593 1.485-1.687 1.485zM94.782 18H93.5v-1.438h-.922V18h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .563-.062.688-.11l-.188-.827c-.078.015-.203.047-.406.047-.406 0-.797-.125-.797-.907v-3.5h1.281V18zm3.838 6.125c1.219 0 2.11-.61 2.391-1.516l-.891-.25c-.234.625-.777.938-1.5.938-1.082 0-1.828-.7-1.871-1.985h4.356v-.39c0-2.235-1.329-3-2.579-3-1.625 0-2.703 1.281-2.703 3.125s1.063 3.078 2.797 3.078zm-1.871-3.61c.063-.933.723-1.765 1.777-1.765 1 0 1.641.75 1.641 1.766h-3.418zm9.445 5.735c.832 0 1.418-.441 1.766-1.375l2.555-6.86-1.008-.015-1.656 4.781h-.063L106.131 18h-1l2.219 6.031-.172.469c-.336.914-.75 1-1.422.828l-.235.813c.094.047.36.109.672.109zm7.763-2.125c1.625 0 2.719-1.234 2.719-3.094 0-1.875-1.094-3.11-2.719-3.11-1.625 0-2.719 1.235-2.719 3.11 0 1.86 1.094 3.094 2.719 3.094zm0-.828c-1.234 0-1.797-1.063-1.797-2.266s.563-2.281 1.797-2.281 1.797 1.078 1.797 2.281-.563 2.266-1.797 2.266zm7.907-1.75c0 1.125-.859 1.64-1.547 1.64-.765 0-1.312-.562-1.312-1.437V18h-.922v3.813c0 1.53.813 2.265 1.938 2.265.906 0 1.5-.484 1.781-1.094h.062V24h.922v-6h-.922v3.547zM124.474 24h.922v-3.797c0-.812.64-1.406 1.515-1.406.246 0 .5.047.563.062v-.937a8.902 8.902 0 00-.485-.016c-.718 0-1.343.407-1.562 1h-.063V18h-.89v6zM45.516 34h-1.344v-.61c0-.593.25-.906.86-.906.265 0 .421.063.515.094l.266-.797c-.141-.062-.422-.156-.876-.156-.859 0-1.687.516-1.687 1.547V34h-.969v.781h.969V40h.922v-5.219h1.344V34zm1.292 6h.922v-6h-.922v6zm.468-7c.36 0 .657-.281.657-.625s-.297-.625-.657-.625c-.359 0-.656.281-.656.625s.297.625.656.625zm2.142 7h.922v-3.797c0-.812.64-1.406 1.515-1.406.247 0 .5.047.563.062v-.937a8.872 8.872 0 00-.484-.016c-.72 0-1.344.407-1.563 1h-.062V34h-.891v6zm8.343-4.656c-.29-.852-.938-1.422-2.125-1.422-1.266 0-2.203.719-2.203 1.734 0 .828.492 1.383 1.593 1.64l1 .235c.606.14.891.43.891.844 0 .516-.547.938-1.406.938-.754 0-1.227-.325-1.39-.97l-.876.22c.215 1.019 1.055 1.562 2.281 1.562 1.395 0 2.344-.762 2.344-1.797 0-.836-.523-1.363-1.594-1.625l-.89-.219c-.711-.175-1.032-.414-1.032-.875 0-.515.547-.89 1.282-.89.804 0 1.136.445 1.297.86l.828-.235zM61.867 34h-1.281v-1.438h-.922V34h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .563-.062.688-.11l-.188-.827c-.078.015-.203.047-.406.047-.406 0-.797-.126-.797-.907v-3.5h1.281V34zm6.246 6.14c1.047 0 1.594-.562 1.781-.953h.047V40h.922v-3.953c0-1.906-1.453-2.125-2.219-2.125-.906 0-1.937.312-2.406 1.406l.875.313c.203-.438.684-.907 1.563-.907.847 0 1.265.45 1.265 1.22v.03c0 .446-.453.407-1.547.547-1.113.145-2.328.39-2.328 1.766 0 1.172.907 1.844 2.047 1.844zm.14-.828c-.734 0-1.265-.328-1.265-.968 0-.703.64-.922 1.36-1.016.39-.047 1.437-.156 1.593-.344v.844c0 .75-.593 1.484-1.687 1.484zm5.215-2.921c0-1.047.648-1.641 1.531-1.641.856 0 1.375.559 1.375 1.5V40h.922v-3.813c0-1.53-.817-2.265-2.031-2.265-.907 0-1.47.406-1.75 1.016h-.079V34h-.89v6h.922v-3.61zm6.434 0c0-1.047.649-1.641 1.532-1.641.855 0 1.375.559 1.375 1.5V40h.922v-3.813c0-1.53-.817-2.265-2.032-2.265-.906 0-1.468.406-1.75 1.016h-.078V34h-.89v6h.921v-3.61zm7.95 3.734c1.626 0 2.72-1.234 2.72-3.094 0-1.875-1.094-3.11-2.72-3.11-1.624 0-2.718 1.235-2.718 3.11 0 1.86 1.094 3.094 2.719 3.094zm0-.828c-1.234 0-1.796-1.063-1.796-2.266s.562-2.281 1.797-2.281c1.234 0 1.796 1.078 1.796 2.281s-.562 2.266-1.796 2.266zM94.589 34h-1.281v-1.438h-.922V34h-.907v.781h.907v3.75c0 1.047.843 1.547 1.625 1.547.343 0 .562-.062.687-.11l-.187-.827c-.078.015-.203.047-.407.047-.406 0-.796-.126-.796-.907v-3.5h1.28V34zm3.152 6.14c1.047 0 1.594-.562 1.782-.953h.046V40h.922v-3.953c0-1.906-1.453-2.125-2.218-2.125-.907 0-1.938.312-2.407 1.406l.875.313c.203-.438.684-.907 1.563-.907.847 0 1.265.45 1.265 1.22v.03c0 .446-.453.407-1.546.547-1.114.145-2.329.39-2.329 1.766 0 1.172.907 1.844 2.047 1.844zm.14-.828c-.733 0-1.265-.328-1.265-.968 0-.703.64-.922 1.36-1.016.39-.047 1.437-.156 1.593-.344v.844c0 .75-.593 1.484-1.687 1.484zM104.783 34h-1.281v-1.438h-.922V34h-.906v.781h.906v3.75c0 1.047.844 1.547 1.625 1.547.344 0 .563-.062.688-.11l-.188-.827c-.078.015-.203.047-.406.047-.406 0-.797-.126-.797-.907v-3.5h1.281V34zm1.387 6h.922v-6h-.922v6zm.469-7c.359 0 .656-.281.656-.625s-.297-.625-.656-.625c-.36 0-.657.281-.657.625s.297.625.657.625zm4.579 7.125c1.625 0 2.719-1.234 2.719-3.094 0-1.875-1.094-3.11-2.719-3.11-1.625 0-2.719 1.235-2.719 3.11 0 1.86 1.094 3.094 2.719 3.094zm0-.828c-1.235 0-1.797-1.063-1.797-2.266s.562-2.281 1.797-2.281c1.234 0 1.797 1.078 1.797 2.281s-.563 2.266-1.797 2.266zm5.048-2.906c0-1.047.648-1.641 1.531-1.641.855 0 1.375.559 1.375 1.5V40h.922v-3.813c0-1.53-.817-2.265-2.031-2.265-.907 0-1.469.406-1.75 1.016h-.079V34h-.89v6h.922v-3.61z"/></svg>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  import AnnotationItem from '@/components/AnnotationItem'
  import AnnotationList from '@/components/AnnotationList'
  import Sidebar from '@/components/Sidebar'
  import { store, mutations } from '@/store'
  import Button from '@/components/ui/Button'
  import Icon from '@/components/ui/Icon'
  import { generateAnnotItemObject } from '@/utils/utils'


  export default {
    components: { AnnotationItem, AnnotationList, Sidebar, Button, Icon },

    computed: {
      'annotData':              { get: () => store.annotData,               set: mutations.setAnnotData },
      'watchAnnotations':       { get: () => store.watchAnnotations,        set: mutations.setWatchAnnotations },
      'userSelection':          { get: () => store.userSelection,           set: mutations.setUserSelection },
      'selectedWrapperFrameId': { get: () => store.selectedWrapperFrameId,  set: mutations.setSelectedWrapperFrameId },
      'userSelectionIds': () => this.userSelection.map((selection) => selection.id)
    },

    methods: {
      async toggleWatcher( newVal ) {
        await this.$nextTick()
        this.watchAnnotations = newVal
        return Promise.resolve()
      },

      createFirstAnnot() {
        parent.postMessage({ pluginMessage: {
          type: 'createFirstAnnot', 
          value: {}
        }}, '*')
      }
    },

    async mounted() {
      onmessage = async event => {
        if (!event.data || !event.data.pluginMessage) 
          return

        const msg = event.data.pluginMessage,
              msgValue = msg && msg.value

        switch (msg.type) {
          case 'doInit':
            await this.toggleWatcher(false)
            this.annotData = msgValue
            if (this.annotData && this.annotData.length) {
              let wrapperFrameId = this.annotData[0].id
              // if (!this.selectedWrapperFrameId)
                this.selectedWrapperFrameId = wrapperFrameId
            }

            await this.toggleWatcher(true)
            break

          case 'selectionUpdated':
            this.userSelection = msgValue
            break

          case 'createFirstAnnot_wrapperNodeCreated':
            mutations.addAnnotDataNewAnnot(
              this.selectedWrapperFrameId,
              generateAnnotItemObject(this.userSelectionIds)
            )
            break

          case 'createAnnotGroup_wrapperNodeCreated':
            this.selectedWrapperFrameId = msgValue.createdWrapperNodeId

            await this.toggleWatcher(true)
            mutations.addAnnotDataNewAnnot(
              this.selectedWrapperFrameId,
              generateAnnotItemObject(this.userSelectionIds)
            )

            break

          case 'userFirstOpenedPlugin':
            mutations.setIsOnboardingViewOpened(true)
            break
        }
      }
    }
  }
</script>

<style lang="scss" scoped>
  .grid {
    height: 100%;
    display: grid;
    grid-template-columns: 160px 1fr;
    --shadow: -9px 0px 49px rgba(0, 0, 0, 0.0196296), -3.46667px 0px 15.6074px rgba(0, 0, 0, 0.0303704), -0.733333px 0px 3.99259px rgba(0, 0, 0, 0.05);

    .sidebar {
      grid-column: 1 / 2;
    }

    .content {
      grid-column: 2 / 3;
      border-radius: 16px 0 0 16px;
      overflow: hidden;
      box-shadow: var(--shadow);
      position: relative;
    
      .emptyState {
        // padding: 16px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        background: $color--background-white;
        position: relative;

        &-step1, &-step2 {
          transition: opacity 100ms ease;

          &.fadeOut {
            opacity: .25;
          }
          
          & > svg {
            display: block;
            margin-left: auto;
            margin-right: auto;
          }
        }

        &-inner {
          width: 100%;
        }

        &-step1 {
          margin-bottom: 56px;

          &-illustration {
            display: block;
            box-shadow: var(--shadow);
            border-radius: 8px;

            &.fadeOut {
              opacity: .1;
            }
          }

          &-text {
            margin-top: 16px;
            transform: translateX(-72px);
          }
        }

        &-step2 {
          &-button {
            display: flex;
            margin: 0 auto;
          }

          &-text {
            margin-top: 16px;
            transform: translateX(88px);
          }
        }
      }
    }
  }
</style>